<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Details</title>
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- JSZip for handling zip files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- Marked for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- QRious for QR code generation -->
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>

    <!-- === KaTeX Library Tags === -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="exam.css">
    <script src="exam.js"></script>
</head>
<body>

    <div class="container">
        <a href="index.html">← Back to All Exams</a>
        <h1 id="exam-name-title">Loading Exam...</h1>
        <button id="show-rules-button" class="hidden" style="margin: 0 auto 1rem auto; display: block; background-color: #ffc107; color: #212529;">Show Grading Regulations</button>
        <div id="questions-container"></div>
    </div>

    <!-- Upload Forms -->
    <div class="container">
        <h2>Upload Appendix</h2>
        <form id="appendix-form">
            <div class="form-group">
                <label for="appendix-files">Appendix File(s) (PDF or Images)</label>
                <input type="file" id="appendix-files" accept=".pdf,image/*" multiple required>
            </div>
            <button type="submit" id="submit-appendix-button">Process and Upload Appendix</button>
        </form>
        <div id="spinner-appendix" class="spinner hidden"></div>
        <div id="status-log-appendix">Upload an appendix to link it to questions in this exam.</div>
    </div>
    <div class="container">
        <h2>Upload Answer Model</h2>
        <form id="model-form">
            <div class="form-group">
                <label for="model-files">Answer Model File(s) (PDF or Images)</label>
                <input type="file" id="model-files" accept=".pdf,image/*" multiple required>
            </div>
            <button type="submit" id="submit-model-button">Process and Upload Answer Model</button>
        </form>
        <div id="spinner-model" class="spinner hidden"></div>
        <div id="status-log-model">Upload the official answer model for this exam.</div>
    </div>
    <div class="container">
        <h2>Upload Student Answers</h2>
        <form id="student-answers-form">
            <div class="form-group">
                <label for="student-name">Student Full Name</label>
                <input type="text" id="student-name" placeholder="e.g., Jane Doe">
            </div>
            <div class="form-group">
                <label for="student-number">Student Number</label>
                <input type="text" id="student-number" placeholder="e.g., s1234567">
            </div>
            <!-- Removed file input for direct upload -->
            <!-- <div class="form-group">
                <label for="student-answer-files">Student's Answer File(s) (Images)</label>
                <input type="file" id="student-answer-files" accept="image/*" multiple required>
            </div> -->
            <button type="button" id="generate-scan-link-button">Generate Scan Link</button>
            <div id="scan-link-area" class="hidden" style="text-align: center; margin-top: 1.5rem;">
                <p>Scan this QR code with your phone to upload answers:</p>
                <canvas id="qrcode-canvas" style="width: 200px; height: 200px; margin: 1rem auto; display: block;"></canvas>
                <p>Or open this link on your phone: <a id="scan-url" href="#" target="_blank"></a></p>
            </div>
        </form>
        <div id="spinner-student" class="spinner hidden"></div>
        <div id="status-log-student">Upload a student's handwritten answers. Provide at least a name or student number.</div>
    </div>
    <div class="container">
        <h2>Automatic Grading</h2>
        <p>This will find all submitted student exams that have not yet been graded, send them for AI evaluation, and save the results.</p>
        <button id="grade-all-button">Grade All Ungraded Submissions</button>
        <div id="spinner-grading" class="spinner hidden"></div>
        <div id="status-log-grading">Click the button to start the grading process.</div>
    </div>

    <!-- Modals -->
    <div id="rules-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="modal-close" id="rules-modal-close">×</span>
            <h2>Grading Regulations</h2>
            <div id="rules-modal-text" class="formatted-text"></div>
        </div>
    </div>
    <div id="appendix-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="modal-close" id="appendix-modal-close">×</span>
            <h2 id="appendix-modal-title">Appendix</h2>
            <div id="appendix-modal-content" class="formatted-text"></div>
        </div>
    </div>
</body>
</html>
